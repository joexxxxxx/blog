
### 内存、性能优化

1. 通过Chrome内存快照工具分析发现接收一条数据，就会有大量的闭包、大数组和对象新增
2. 闭包大连来自Vue的数据劫持setter和getter函数导致内存瞬间上升很大释放很慢
3. 通过冻结消息列表和缓存会话对象减少大量的闭包生成

### 结果

1. 1400左右会话情况下登录占用内存减少 150M左右
2. 100毫秒一条接收消息频率内存上升比优化直接减少20M， 内存峰值在450M左右，均值在320~350之间

```js
requestIdleCallback
Q1: requestIdleCallback 会在每一次帧结束时执行吗？
A1: 只会在帧末尾有空闲时间时会执行，不应该期望每一次帧结束都会执行requestIdleCallback。
😂😂😂😂😂😂😂😂😂😂😂😂😂😂😂😂😂😂😂😂
Q2: 什么操作不适合放到 requestIdleCallback 的callback中。
A2: 更新DOM，以及Promise的回调（会使帧超时），什么意思？请看下面的代码。requestIdleCallback中代码，应该是一些可以预测执行时间的小段代码

作者：dyhtps
链接：https://juejin.cn/post/6844904081463443463
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
```