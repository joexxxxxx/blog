# 前端优化

## 文章出处

[前端性能优化总结(掘金)](https://juejin.cn/post/6844904195707895816#heading-10)



## 性能分类

对前端工程性能的优化，我觉得可以分为两类：

1. 站在用户视角的主观的可感知的性能。
 - 对于用户来说，用户的感知性能才是最重要的，简单讲，就是让用户感觉你的网站访问很快，并且感知性能没有衡量标准。
 - 不过，凡事总有例外，如果一个页面的加载时间就会很长，我们也可以通过一些方式让用户觉得没有那么慢。
 - 总之一句话，你的页面可以做的不快，但是你可以让你的用户觉得你很快。
2. 站在开发者视角的可客观度量的性
 - 对于开发者来说，性能指标是可以客观度量的，我们可以通过一些手段来优化 Web 性能，使这些度量指标达到开发者设定的标准。
 - 客观性能是指，从用户输入url开始，到下载、解析和执行所有资源以及最终绘制的整个过程的时间度量。
 - 性能指标是个很复杂的标准，后续我会单独整理出一篇文章介绍性能指标。

## 性能感知优化

1. 采用骨骼屏 让优化感觉更快了

## 构建优化

1. 开启gzip压缩
2. 去掉 console.log
3. 去除SourceMap
4. 合理拆包， 或使用CDN减少打包体积
## 网络层面

1. HTTP缓存
2. 混合App原生缓存
3. PWA

## 渲染层面



## web worker

1. 将需要大量计算的操作可以放入webWork中处理

2. 使用场景
   - Excel大文件到处
   - 离屏canvas压缩图片

## 性能衡量指标

First Paint 首次绘制（FP）
First contentful paint 首次内容绘制 (FCP)
Largest contentful paint 最大内容绘制 (LCP)
First input delay 首次输入延迟 (FID)
Time to Interactive 可交互时间 (TTI)
Total blocking time 总阻塞时间 (TBT)
Cumulative layout shift 累积布局偏移 (CLS)
1. web-vitals
```js
import { ReportHandler } from 'web-vitals';

const reportWebVitals = (onPerfEntry?: ReportHandler) => {
  if (onPerfEntry && onPerfEntry instanceof Function) {
    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {
      getCLS(onPerfEntry);
      getFID(onPerfEntry);
      getFCP(onPerfEntry);
      getLCP(onPerfEntry);
      getTTFB(onPerfEntry);
    });
  }
};

export default reportWebVitals;

```

| 指标              |                    计算                    |
| ----------------- | :----------------------------------------: |
| 首屏加载时间(FP)  |      responseStart - navigationStart       |
| DNS 解析时间      |       domainLookupEnd - connectStart       |
| dom 渲染完成时间  | domContentLoadedEventEnd - navigationStart |
| 页面 onload 时间  |       loadEventEnd - navigationStart       |
| 重定向耗时        |        redirectEnd - redirectStart         |
| TCP 连接耗时      |         connectEnd - connectStart          |
| SSL 连接耗时      |     connectEnd - secureConnectionStart     |
| TTFB 网络请求耗时 |        responseStart - requestStart        |
| 数据传输耗时      |        responseEnd - responseStart         |
| 资源加载耗时      | loadEventStart - domContentLoadedEventEnd  |